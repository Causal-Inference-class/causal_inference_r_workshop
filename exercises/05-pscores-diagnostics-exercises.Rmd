---
title: "Propensity Score Diagnostics"
output: html_document
---


```{r}
library(tidyverse)
library(broom)
library(tidysmd)
library(causaldata)
library(ggecdf)
```

Using the National Health and Nutrition Examination Survey Data (`nhefs_complete`), we are interested in the relationship between the **exposure**, `qsmk`: whether the participant quit smoking, and the **outcome**, `wt82_71`: their weight change in kilograms.

Below is the propensity score model and weights you created in the previous exercise.

```{r, eval = FALSE}
propensity_model <- glm(
  qsmk ~ age + sex + wt71 + smokeyrs,
  data = nhefs_complete,
  family = binomial()
)

df <- propensity_model %>%
  augment(type.predict = "response", data = nhefs_complete) %>%
  mutate(w_ate = 1 / ifelse(qsmk == 0, 1 - .fitted, .fitted))
```

## Your Turn 1

_After updating the code chunks below, change `eval = TRUE` before knitting._

Calculate the standardized mean differences with and without weights

```{r, eval = FALSE}
smds <- tidy_smd(
  df, 
  .vars = ____,
  .group = ____,
  .wts = ____
)
```

Create the Love Plot using ggplot

```{r, eval = FALSE}
ggplot(
  data = ____,
  aes(x = abs(____), y = ____, group = ____, color = ____)
) +
  geom_line(orientation = "y") +
  geom_point() + 
  geom_vline(xintercept = 0.1, color = "black", size = 0.1)
```



## Your Turn 2

Create an unweighted ECDF for `smokeyrs` by those who quit smoking and those who did not.

```{r, eval = FALSE}
ggplot(df, aes(x = ____, group = ____, color = factor(____))) +
  ____() +
  scale_color_manual("Quit smoking", values = c("#5154B8", "#5DB854"),
                     labels = c("Yes", "No")) + 
  xlab(____) + 
  ylab("Proportion <= x") 
```


Create an weighted ECDF for `smokeyrs` by those who quit smoking and those who did not.

```{r, eval = FALSE}
ggplot(df, aes(x = ____, color = factor(____))) +
  ____(aes(weights = ____)) + 
  scale_color_manual("Quit smoking", values = c("#5154B8", "#5DB854"),
                     labels = c("Yes", "No")) +
  xlab(____) +
  ylab("Proportion <= x (Weighted)")
```

